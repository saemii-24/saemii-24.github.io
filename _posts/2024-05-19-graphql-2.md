---
title: "Graph QL(2) - Apollo"
author: saemii
categories:
  - Optimize
tags:
  - [Optimize, Next.js, Project]
date: 2024-05-19
last_modified_at: 2024-05-19
pin: true
---

## ğŸ“Œì‹œì‘í•˜ë©°

Graph QL ê´€ë ¨ ìë£Œë¥¼ ì°¾ë‹¤ë³´ë‹ˆ, Apolloë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ë³´ì•˜ë‹¤.ğŸ˜ ApolloëŠ” ë¬´ì—‡ì¸ì§€, ì–´ë–»ê²Œ ì ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ê³  Graph QL ê´€ë ¨ëœ ìœ íŠœë¸Œ ì˜ìƒì—ì„œ ë°°ìš´ ë‚´ìš©ì„ ë‚˜ë¦„ëŒ€ë¡œ ì •ë¦¬í•´ë³´ê³ ì í•œë‹¤.

## âœ…Apolloë€?

ê³µì‹ ë¬¸ì„œì˜ ì„¤ëª…ì„ ì‚´í´ë³´ì.

> ApolloëŠ” ë°ì´í„°ë¥¼ í†µí•©í•˜ê³  ì„œë¹„ìŠ¤ë“¤ì„ ë‹¨ì¼ ë¶„ì‚° GraphQL APIì¸ ìŠˆí¼ê·¸ë˜í”„(supergraph)ë¡œ í†µí•©í•  ìˆ˜ ìˆëŠ” ê°œë°œì í”Œë«í¼ê³¼ ë„êµ¬ë¥¼ ì œê³µí•œë‹¤. ApolloëŠ” ì²˜ìŒìœ¼ë¡œ APIë¥¼ êµ¬ì¶•í•˜ê±°ë‚˜ APIë¥¼ ì¿¼ë¦¬í•˜ê±°ë‚˜, í”Œë«í¼ì„ ìŠˆí¼ê·¸ë˜í”„ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ë•Œê¹Œì§€, ì–´ë–¤ ë‹¨ê³„ë‚˜ ê·œëª¨ì—ì„œë„ GraphQLì´ íš¨ê³¼ì ìœ¼ë¡œ ì‘ë™í•˜ë„ë¡ ë„ì™€ì¤€ë‹¤.

**ìŠˆí¼ê·¸ë˜í”„ :** ì—¬ëŸ¬ ê°œì˜ GraphQL ì„œë¹„ìŠ¤ì™€ ë°ì´í„° ì†ŒìŠ¤ë¥¼ í•˜ë‚˜ì˜ í†µì¼ëœ GraphQL APIë¡œ í•©ì¹œ ê²ƒ

ì¦‰, ApolloëŠ” ë°ì´í„°ì™€ ì„œë¹„ìŠ¤ë¥¼ ê°„ë‹¨í•˜ê²Œ í†µí•©í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ê³ , GraphQLì„ íš¨ìœ¨ì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ë„êµ¬ë‹¤.

## âœ…Apollo Server

> Apollo ServerëŠ” ì‚¬ì–‘ì„ ì¤€ìˆ˜í•˜ëŠ” ì˜¤í”ˆ ì†ŒìŠ¤ GraphQL ì„œë²„ë¡œ, Apollo í´ë¼ì´ì–¸íŠ¸ë¥¼ ë¹„ë¡¯í•œ ëª¨ë“  GraphQL í´ë¼ì´ì–¸íŠ¸ì™€ í˜¸í™˜ëœë‹¤.

Apollo Serverë¥¼ í†µí•´ ê°„ë‹¨í•œ ì„¤ì •ìœ¼ë¡œ ê°œë°œìê°€ ë¹ ë¥´ê²Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤!

### â¡ï¸í”„ë¡œì íŠ¸ ì‹œì‘

ğŸ“Œ **1. ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°**

```bash
mkdir graphql-server-example
cd graphql-server-example
```

ğŸ“Œ **2. package.json ìƒì„±**

```bash
npm init --yes && npm pkg set type="module"
```

ğŸ“Œ **3. ì¢…ì†ì„± ì„¤ì¹˜**

```bash
npm install @apollo/server graphql
```

### â¡ï¸ GraphQL schema ì„¤ì •

ì°¸ê³ ë¡œ, typeDefs = `` ë¡œ ì‘ì„±í•˜ë©´ ì•ˆì˜ schema ë“¤ì´ string ì²˜ëŸ¼ í‘œì‹œë˜ëŠ”ë°, <u>vsCode í™•ì¥í”„ë¡œê·¸ë¨ì„ ì„¤ì¹˜</u>í•˜ë©´ ì ì ˆí•˜ê²Œ ì»¬ëŸ¬ê°€ ë³€ê²½ë˜ì–´ ë³´ê¸° ì¢‹ì•„ì§„ë‹¤.

```typescript
import { ApolloServer } from "@apollo/server"
import { startStandaloneServer } from "@apollo/server/standalone"

const typeDefs = `
  type Book {
    title: String
    author: String
  }

  type Query {
    books: [Book]
  }
`
```

í•˜ë‚˜ì”© ì‚´í´ë³´ì.

| ìš”ì†Œ         | ì„¤ëª…                                                                                                              |
| ------------ | ----------------------------------------------------------------------------------------------------------------- |
| `typeDefs`   | GraphQL ìŠ¤í‚¤ë§ˆ ì–¸ì–´ë¡œ ì‘ì„±ëœ ë¬¸ìì—´                                                                               |
| `type Book`  | Book íƒ€ì…ì— ëŒ€í•œ ë°ì´í„° ëª¨ë¸ ì •ì˜                                                                                 |
| `type Query` | í´ë¼ì´ì–¸íŠ¸ê°€ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ì¿¼ë¦¬ë¥¼ ì •ì˜<br/>APIì˜ ì§„ì…ì  ì—­í• ë¡œ, í´ë¼ì´ì–¸íŠ¸ê°€ ì–´ë–¤ ë°ì´í„°ë¥¼ ìš”ì²­í•  ìˆ˜ ìˆëŠ”ì§€ ê·œì • |

ë‹¤ìŒê³¼ ê°™ì´ ë°ì´í„° ëª¨ë¸ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤!

```typescript
const typeDefs = `
  type Book {
    title: String
    author: String
  }

  type Movie {
    title: String
    release: Int
  }

  type Query {
    books: [Book]
    movies: [Movie]
  }
`
```

### â¡ï¸data set ì„¤ì •

ìœ„ì—ì„œëŠ” ë°ì´í„° êµ¬ì¡°ë¥¼ ì •ì˜í–ˆìœ¼ë‹ˆ, ë°ì´í„°ë¥¼ ì •ì˜í•˜ì.
ìœ„ì—ì„œ `type Query {books: [Book]}`ë¥¼ ì‘ì„±í–ˆëŠ”ë° ì—¬ê¸°ì„œ booksë¥¼ ì§€ì •í•´ì¤€ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.

```typescript
const books = [
  {
    title: "The Awakening",
    author: "Kate Chopin",
  },
  {
    title: "City of Glass",
    author: "Paul Auster",
  },
]
```

### â¡ï¸resolver ì •ì˜

data setì„ ì •ì˜í–ˆì§€ë§Œ, Apollo SeverëŠ” ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œ í•´ë‹¹ data setì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì•Œì§€ ëª»í•˜ê¸° ë•Œë¬¸ì—, resolverë¥¼ ìƒì„±í•œë‹¤.

```typescript
const resolvers = {
  Query: {
    books: () => books,
  },
}
```

### â¡ï¸ApolloSever ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

```typescript
//ìŠ¤í‚¤ë§ˆ ì •ì˜ì™€ ë¦¬ì¡¸ë²„ ì§‘í•© ë‘ ê°œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì‘ì„±í•œë‹¤.
const server = new ApolloServer({
  typeDefs,
  resolvers,
})

const { url } = await startStandaloneServer(server, {
  listen: { port: 4000 },
})

console.log(`ğŸš€  Server ready at: ${url}`)
```

## âœ…Apollo Client

> Apollo ClientëŠ” JavaScriptë¥¼ ìœ„í•œ ì¢…í•©ì ì¸ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ GraphQLë¡œ ë¡œì»¬ ë° ì›ê²© ë°ì´í„°ë¥¼ ëª¨ë‘ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ ì´ìš©í•´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³ , ìºì‹œí•˜ê³ , ìˆ˜ì •í•˜ëŠ” ë™ì‹œì— UIë¥¼ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë‹¤.

í•µì‹¬ `@apollo/client` ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” Reactì™€ì˜ í†µí•©ì„ ì œê³µí•œë‹¤.

### â¡ï¸í”„ë¡œì íŠ¸ ì‹œì‘

ğŸ“Œ **1. vite ì´ìš©í•´ React ì„¸íŒ…**

```bash
npm create vite@latest
```

ğŸ“Œ **2. ëª¨ë“ˆ ì„¤ì¹˜**
ë‘ ê°€ì§€ ìµœìƒìœ„ ì¢…ì†ì„±ì„ ì„¤ì¹˜í•œë‹¤.

- `@apollo/client`: Apollo í´ë¼ì´ì–¸íŠ¸ë¥¼ ì„¤ì •í•˜ëŠ” ë° ì‚¬ìš©í•œë‹¤. ì¸ë©”ëª¨ë¦¬ ìºì‹œ, ë¡œì»¬ ìƒíƒœ ê´€ë¦¬, ì˜¤ë¥˜ ì²˜ë¦¬ ë° React ê¸°ë°˜ ë·° ë ˆì´ì–´ê°€ í¬í•¨ëœë‹¤.
- `graphql`: ì´ íŒ¨í‚¤ì§€ëŠ” GraphQL ì¿¼ë¦¬ êµ¬ë¬¸ ë¶„ì„ì„ ìœ„í•œ ë¡œì§ì„ ì œê³µí•œë‹¤.

```bash
npm install @apollo/client graphql
```

### â¡ï¸ApolloClient ì´ˆê¸°í™”

```javascript
import {
  ApolloClient,
  InMemoryCache,
  ApolloProvider,
  gql,
} from "@apollo/client"

//í˜„ì¬ ë¡œì»¬ í™˜ê²½ì—ì„œ ì‹¤í–‰ ë˜ë¯€ë¡œ uriëŠ” ìœ„ì—ì„œ ì„¤ì •í•œ 4000ë²ˆ
const client = new ApolloClient({
  uri: "http://localhost:4000/",
  cache: new InMemoryCache(),
})
```

- `uri`: GraphQL ì„œë²„ì˜ URLì„ ì§€ì •.
- `cache`: ì•„í´ë¡œ í´ë¼ì´ì–¸íŠ¸ê°€ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¨ í›„ ìºì‹±í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” InMemoryCacheì˜ ì¸ìŠ¤í„´ìŠ¤.

### â¡ï¸ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

ë™ì¼í•œ íŒŒì¼ ì•ˆì—ì„œ, ì¿¼ë¦¬ ë¬¸ìì—´(gql í…œí”Œë¦¿ ë¦¬í„°ëŸ´ë¡œ ë˜í•‘)ì„ ì‚¬ìš©í•˜ì—¬ client.query()ë¥¼ í˜¸ì¶œí•œë‹¤.

```javascript
client
  .query({
    query: gql`
      query GetBooks {
        books {
          title
          author
        }
      }
    `,
  })
  .then((result) => console.log(result.data.books))
  .catch((error) => console.error(error))
```

### â¡ï¸ë¦¬ì•¡íŠ¸ì—ì„œ í•¨ê»˜ ì‚¬ìš©í•˜ê¸°

ìœ„ì™€ ê°™ì´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆì§€ë§Œ, ë¦¬ì•¡íŠ¸ì—ì„œ ë” í¸ë¦¬í•˜ê²Œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë„ ìˆë‹¤.

ğŸ“Œ **1. ApolloProvider ê°ì‹¸ê¸°**
Reactì˜ Context.Provider ì²˜ëŸ¼ ApolloProviderë¥¼ ì´ìš©í•´ React ì•±ì„ ë˜í•‘í•˜ê³  Apollo í´ë¼ì´ì–¸íŠ¸ë¥¼ ì»¨í…ìŠ¤íŠ¸ì— ë°°ì¹˜í•˜ì.

```javascript
const root = ReactDOM.createRoot(document.getElementById("root"))

root.render(
  <ApolloProvider client={client}>
    <App />
  </ApolloProvider>
)
```

ğŸ“Œ **2. ApolloProvider ê°ì‹¸ê¸°**
ApolloProviderê°€ ì—°ê²°ë˜ë©´, useQueryë¡œ ë°ì´í„° ìš”ì²­ì„ ì‹œì‘í•  ìˆ˜ ìˆë‹¤. useQuery í›…ì€ GraphQL ë°ì´í„°ë¥¼ UIì™€ ê³µìœ í•˜ëŠ” React í›…ì´ë‹¤!

```javascript
import { useQuery, gql } from "@apollo/client"

// books ì¿¼ë¦¬ ì •ì˜
const GET_BOOKS = gql`
  query GetBooks {
    books {
      title
      author
    }
  }
`

// DisplayBooks ì»´í¬ë„ŒíŠ¸
function DisplayBooks() {
  const { loading, error, data } = useQuery(GET_BOOKS)

  if (loading) return <p>Loading...</p>
  if (error) return <p>Error : {error.message}</p>

  return data.books.map(({ title, author }, index) => (
    <div key={index}>
      <h3>{title}</h3>
      <p>{author}</p>
      <br />
    </div>
  ))
}

// App ì»´í¬ë„ŒíŠ¸ ì—…ë°ì´íŠ¸
export default function App() {
  return (
    <div>
      <h2>My first Apollo app ğŸš€</h2>
      <DisplayBooks />
    </div>
  )
}
```

## ğŸ—‚ï¸ì°¸ê³  ì‚¬ì´íŠ¸

- <https://www.apollographql.com/docs/>
