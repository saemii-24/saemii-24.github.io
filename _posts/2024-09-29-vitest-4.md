---
title: "FE테스트(4) - 전역 상태 관리"
author: saemii
categories:
  - Test
tags:
  - [Vitest, ReatTestingLibrary]
date: 2024-09-29
last_modified_at: 2024-09-29
pin: true
---

## 📌시작하며

기본적인 테스트 과정과 흐름에 대해 알아봤으니 이번엔 context API나 zustand와 같은 전역 상태 관리를 테스트 해보자.

## ✅context API

사실 처음엔 **전역 상태 관리** 를 테스트 한다는 거에 어떻게 하는건지 고민되었지만,
**전역 상태 관리** 에 초점을 맞추지 말고 **사용자에게 보여지는 것** 에 초점을 맞춰보면 쉽게 테스트 할 수 있다.

전체적인 흐름도 앞서 살펴본 것과 동일하다.
특별히 전역 상태 관리를 위해 API를 쓰는 것이 아니라 A에서 트리거를 발생시키고 B에 제대로 반영이 되는지 테스트하면 되기 때문이다.

### ➡️예제

먼저 context API를 작성해주었다.

```typescript
import React, { createContext, useContext, useState, ReactNode } from "react"

// CountContext 타입 정의
interface CountContextType {
  count: number
  increment: () => void
}

// Context 생성
const CountContext = createContext<CountContextType | undefined>(undefined)

// Provider 컴포넌트
export const CountProvider: React.FC<{ children: ReactNode }> = ({
  children,
}) => {
  const [count, setCount] = useState(0)

  const increment = () => setCount((prev) => prev + 1)

  return (
    <CountContext.Provider value={{ count, increment }}>
      {children}
    </CountContext.Provider>
  )
}

// Hook을 사용하여 Context 값 접근
export const useCount = () => {
  const context = useContext(CountContext)
  if (!context) {
    throw new Error("에러 발생!")
  }
  return context
}
```

이후 과정은 A 컴포넌트에서 increment를 호출하고 B 컴포넌트에서 숫자를 렌더링한다.
간단한 부분이라 코드는 생략한다.

```typescript
import { CountProvider } from "@/context/CountContext"
import React from "react"
import { AComponent } from "./AComponent"
import { BComponent } from "./BComponent"

const AllComponent = () => {
  return (
    <CountProvider>
      <AComponent />
      <BComponent />
    </CountProvider>
  )
}

export default AllComponent
```

이후 다음과 같이 `AComponent와` `BComponent`를 `CountProvider`로 감싸주었다.
그리고 테스트 `AllComponent.spec.tsx`를 작성해 주었다.

전체 흐름은 위에서 설명한 것 처럼, 사용자 측면에서 테스트 작성해주면 된다.

```typescript
import { render, screen, fireEvent } from "@testing-library/react"
import { describe, it, expect } from "vitest"
import AllComponent from "./AllComponent"

describe("All Componet Context API", () => {
  it("A 컴포넌트에서 count를 증가시키면, B 컴포넌트에서도 count가 업데이트 된다.", () => {
    render(<AllComponent />)

    //aCount와 bCount가 동일하기 때문에 <p data-testid="a-count"/> 속성을 사용해 구분한다.
    //구분할 수 없을때만 사용함에 주의
    const aCount = screen.getByTestId("a-count")
    const bCount = screen.getByTestId("b-count")

    //Increment 버튼을 클릭한다.
    fireEvent.click(screen.getByText(/Increment/i))

    // A 컴포넌트의 count가 1로 업데이트 되었는지 확인
    expect(aCount).toHaveTextContent("Count: 1")

    // B 컴포넌트의 count도 1로 업데이트 되었는지 확인
    expect(bCount).toHaveTextContent("Count: 1")
  })
})
```
