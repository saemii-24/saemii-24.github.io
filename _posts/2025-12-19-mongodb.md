---
title: "mongo dbë¥¼ ì‚¬ìš©í•´ë³´ì"
author: saemii
categories:
  - mongodb
tags:
  - [mongodb]
date: 2025-12-19
last_modified_at: 2025-12-19
pin: true
---

# â­ Mongo DB

ê³¼ê±°ì— í”„ë¡ íŠ¸ì—”ë“œ ê³µë¶€ë¥¼ í•˜ë©´ì„œ ëª‡ ë²ˆ ë§ˆì£¼ì³¤ë˜ Mongo DB, ì‚¬ì‹¤ ê·¸ ë•ŒëŠ” ì§€ì‹ì´ ë§ì´ ë¶€ì¡±í•œ ìƒíƒœì—ì„œ ì‚¬ìš©í•˜ë ¤ê³  í•˜ë‹ˆ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë„ˆë¬´ ì–´ë ¤ì›Œì„œ ê°œì¸ì ìœ¼ë¡œëŠ” ì¡°ê¸ˆ ë” ì‰¬ìš´ Firebaseë¥¼ ì‚¬ìš©í–ˆì—ˆë‹¤.

ì´ë²ˆì— ê°œì¸ í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ dbë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì€ë°, ì–´ë–¤ê±¸ ì‚¬ìš©í•´ë³¼ê¹Œ í•˜ë‹¤ê°€ ê·¸ ë•Œ ì ì‹œ ë¯¸ë¤„ë‘” Mongo DBê°€ ìƒê°ë‚˜ì„œ ì´ë¥¼ ì‚¬ìš©í•´ë³´ê³ ì í•œë‹¤.

Mongo DBëŠ” ëŒ€í‘œì ì¸ NoSQL ë°ì´í„°ë² ì´ìŠ¤ë¡œ, BSON í˜•ì‹ì„ ì‚¬ìš©í•œë‹¤

> BSON ë˜ëŠ” Binary JSONì€ MongoDBê°€ ë°ì´í„°ë¥¼ êµ¬ì„±í•˜ê³  ì €ì¥í•˜ëŠ” ë° ì‚¬ìš©í•˜ëŠ” ë°ì´í„° í˜•ì‹

# ğŸŒŸ Mongoose

Mongoose (ì´í•˜ ëª½êµ¬ìŠ¤)ëŠ” Node.jsì—ì„œ Mongo DBë¥¼ ì‰½ê²Œ ë‹¤ë£¨ê¸° ìœ„í•´ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ODMë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤.

> ODMì´ë€ Object Document Mapperì˜ ì•½ì–´ë¡œ, ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ë¥¼ Mongo DB ë¬¸ì„œë¡œ ì‚¬ìš©í•˜ê²Œ í•´ì£¼ë©°, ë°˜ëŒ€ë¡œ Mongo DB ë¬¸ì„œë¥¼ ìë°”ìŠ¤í¬ë¦½íŠ¸ ê°ì²´ì²˜ëŸ¼ ì‚¬ìš©í•˜ê²Œ í•´ì£¼ëŠ” ë„êµ¬ë¥¼ ëœ»í•œë‹¤.

ëª½ê³  DBëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ìŠ¤í‚¤ë§ˆê°€ ì—†ì§€ë§Œ, ëª½êµ¬ìŠ¤ë¥¼ ì´ìš©í•´ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•˜ê³  ëª¨ë¸ì„ ìƒì„±í•˜ë©°, JS ê°ì²´ì²˜ëŸ¼ DBë¥¼ ì¡°ì‘í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

## ğŸ populate

mongoDBëŠ” JOIN ê¸°ëŠ¥ì´ ì—†ê¸° ë•Œë¬¸ì— ì´ì™€ ë¹„ìŠ·í•œ ì—­í• ì„ í•´ì¤„ populateë¥¼ ì‚¬ìš©í•œë‹¤.

Schema ë¶€í„° ì‹œì‘í•´ë³´ì.

ë¨¼ì € users Collection(Table)ì— ì €ì¥ë  Document(ê°œë³„ ë°ì´í„°) ì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•˜ê¸° ìœ„í•´ Schemaë¥¼ ì‘ì„±í•œë‹¤.

```typescript
const userSchema = new Schema({
  email: String,
  nickname: String,
})

const User = mongoose.model("User", userSchema)
```

ë§Œì•½ postì—ì„œ userIdì— users Collectionì— ì €ì¥ëœ ë‚´ìš©ì„ ë‹´ì•„ì˜¤ê³  ì‹¶ë‹¤ë©´ ë°˜ë“œì‹œ refë¥¼ ì‘ì„±í•´ì•¼ í•œë‹¤.

```typescript
const postSchema = new Schema({
  userId: {
    type: Schema.Types.ObjectId,
    ref: "User", //ì´ ObjectIdëŠ” User ëª¨ë¸ì˜ _idì„ì„ ë‚˜íƒ€ëƒ„
  },
  title: String,
  content: String,
})

const Post = mongoose.model("Post", postSchema)
```

posts.userIdì— ì €ì¥ëœ ObjectId ê°’ê³¼ users.\_id ê°’ì´ ì¼ì¹˜í•˜ëŠ” Documentë¥¼ ê¸°ì¤€ìœ¼ë¡œ populateê°€ ì‹¤í–‰ëœë‹¤.

```typescript
Post.find().populate("userId")
```

ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ê°€ ì°¾ì•„ì§„ë‹¤ë©´ ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```typescripT
{
  _id: ObjectId("64f000bbb222bbb222bbb222"),
  title: "ì²« ë²ˆì§¸ ê¸€",
  content: "ë‚´ìš©ì…ë‹ˆë‹¤",
  userId: {
    _id: ObjectId("64f000aaa111aaa111aaa111"),
    email: "example@example.com",
    nickname: "ì§±êµ¬ëŠ” ëª»ë§ë ¤"
  }
}

```

# ğŸ§¡ ìš©ì–´ ì •ì˜

## ğŸ”¸ MongoDBì˜ êµ¬ì¡° ê³„ì¸µ

```
Cluster
 â””â”€â”€ Database
      â””â”€â”€ Collection
           â””â”€â”€ Document
```

### 1. Cluster

Mongo DBê°€ ì‹¤í–‰ë˜ëŠ” ì„œë²„

### 2. Database

1ë²ˆ Cluster(ì„œë²„)ì— ì¡´ì¬í•˜ëŠ” ë°ì´í„° ê³µê°„.

### 3. Collection

ë°ì´í„° ì§‘í•©. RDBMSì˜ Tableê³¼ ê±°ì˜ ë™ì¼í•¨
ê´€ë¡€ìƒ **ë³µìˆ˜í˜• ì†Œë¬¸ì**ë¥¼ ì‚¬ìš©

```
// ë¸”ë¡œê·¸ ì„œë¹„ìŠ¤ ì˜ˆì‹œ (Collections)
posts
users
```

### 4. Document

Collection ì•ˆì˜ ê°œë³„ ë°ì´í„° í•˜ë‚˜.
ê° DocumentëŠ” `_id` ë¥¼ ê°€ì§„ë‹¤.

> ObjectIdëŠ” MongoDBê°€ ê° Documentë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ ìë™ìœ¼ë¡œ ë§Œë“œëŠ” ê³ ìœ  ID íƒ€ì…

```
{
  _id: ObjectId,// ìë™ ìƒì„±
  createdAt: Date,
  userId: ObjectId,// users._id ì°¸ì¡°
  content: String
}
```

## ğŸ”¸ Mongooseì˜ ì£¼ìš” ê°œë…

### 1. Schema

Document (ê°œë³„ ë°ì´í„° í•˜ë‚˜)ì˜ êµ¬ì¡°, í”¼ë“œ, íƒ€ì…, ì œì•½ ì¡°ê±´ ë“±ì„ ì •ì˜
Mongo DBì—ëŠ” ìŠ¤í‚¤ë§ˆê°€ ì—†ê¸° ë•Œë¬¸ì— Mongooseë¥¼ ì´ìš©í•´ ìŠ¤í‚¤ë§ˆë¥¼ ì‘ì„±í•˜ê²Œ ë¨

### 2. Model

íŠ¹ì • Collection í•˜ë‚˜ë¥¼ ì „ë‹´í•˜ì—¬ ë‹¤ë£¨ëŠ” ê°ì²´. Schmaë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±ë˜ì–´, ì „ë‹´í•˜ëŠ” Collectionì˜ CRUDë¥¼ ì§„í–‰í•˜ê²Œ ë¨

## â­ Mongo DBì™€ CRUD

### ğŸŠ Create

ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë©”ì†Œë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- insertOne() â†’ ë‹¨ì¼ ë¬¸ì„œ ìƒì„±
- insertMany() â†’ ì—¬ëŸ¬ ë¬¸ì„œ ìƒì„±

#### 1ï¸âƒ£ insertOne()

```typescript
await db.collection("users").insertOne({
  email: "coco@example.com",
  nickname: "coco",
  createdAt: new Date(), // ë¬¸ì„œ ìƒì„± ì‹œê°
})
```

- `collection("users")`: users ì»¬ë ‰ì…˜ì— ì ‘ê·¼ (ì—†ìœ¼ë©´ ìë™ ìƒì„±ë¨)
- `insertOne()`: ë¬¸ì„œ 1ê°œë¥¼ DBì— ì‚½ì…

> \_id í•„ë“œë¥¼ ëª…ì‹œí•˜ì§€ ì•Šìœ¼ë©´ MongoDBê°€ ìë™ìœ¼ë¡œ ObjectId ìƒì„±í•œë‹¤.

#### 2ï¸âƒ£ insertMany()

```typescript
await db.collection("posts").insertMany([
  { title: "1ì¼ì°¨!", content: "ì²« ë‚  ì¼ê¸°" },
  { title: "2ì¼ì°¨!", content: "ë‘˜ì§¸ ë‚  ì¼ê¸°" },
  { title: "3ì¼ì°¨!", content: "ì…‹ì§¸ ë‚  ì¼ê¸°" },
])
```

> ëª¨ë“  documentì—ëŠ” \_idê°€ ìë™ ìƒì„±ëœë‹¤.

â­ `insertMany`ì˜ ì£¼ìš” ì˜µì…˜ì—ëŠ” **ordered**ê°€ ìˆë‹¤.

```typescript
await db.collection("posts").insertMany(docs, {
  ordered: false,
})
```

```
ordered: true (ê¸°ë³¸ê°’) ì¤‘ê°„ì— í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì „ì²´ ì¤‘ë‹¨
ordered: false ì‹¤íŒ¨í•œ ë¬¸ì„œë§Œ ê±´ë„ˆë›°ê³  ë‚˜ë¨¸ì§€ëŠ” ê³„ì† ì‚½ì…
```

### ğŸŠ Read

- find()
- findOne()

#### 1ï¸âƒ£ find()

```typescript
const userList = await db
  .collection("users")
  .find({ role: "guest" })
  .sort({ name: 1 }) // 1: ì˜¤ë¦„ì°¨ìˆœ, -1: ë‚´ë¦¼ì°¨ìˆœ
  .toArray()
```

roleì´ guestì¸ ê°’ë“¤ì„ ì°¾ì•„ sort í•˜ê³  **ë°°ì—´**ë¡œ ë‚´ë³´ë‚´ê² ë‹¤ëŠ” ì˜ë¯¸ë¡œ ìœ„ì™€ ê°™ì´ ë©”ì†Œë“œ ì²´ì´ë‹ì„ í†µí•´ ê°„ë‹¨í•˜ê²Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

> ê²°ê³¼ê°€ Cursorë¡œ ë‚˜ì˜¤ê¸° ë•Œë¬¸ì— toArray()ë¥¼ ì´ìš©í•´ ë°°ì—´ë¡œ ë°”ê¾¸ê²Œ ëœë‹¤.

ë§Œì•½ ì¼ë¶€ í•„ë“œë§Œ íìš”í•  ê²½ìš° `projection`ì„ ì‚¬ìš©í•œë‹¤.

```typescript
const users = await db
  .collection("users")
  .find({ role: "guest" }, { projection: { email: 1, nickname: 1 } })
  .toArray()
```

ì´ ê²½ìš°ëŠ” roleì´ userì¸ ë¬¸ì„œ ì¤‘ì—ì„œ email, nicknameë§Œ ê°€ì ¸ì˜¨ë‹¤.

#### 2ï¸âƒ£ findOne()

ì¡°ê±´ì— ë§ëŠ” ë¬¸ì„œ 1ê°œë¥¼ ì¡°íšŒí•˜ë©°, ì—¬ëŸ¬ ê°œê°€ ìˆì–´ë„ ì²« ë²ˆì§¸ 1ê°œë§Œ ë°˜í™˜í•œë‹¤.

```typescript
const user = await db.collection("users").findOne({
  email: "coco@example.com",
})
```

> findOneì€ toArrayê°€ í•„ìš”ì—†ë‹¤.

### ğŸŠ Update

- updateOne()
- replaceOne()
- updateMany()

#### 1ï¸âƒ£ updateOne()

ì¼ë¶€ í•„ë“œë§Œ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©í•œë‹¤.

> updateOneì„ ì‚¬ìš©í•  ë•ŒëŠ” [$set](https://www.mongodb.com/ko-kr/docs/manual/reference/operator/update/set/) ë¥¼ ê¼­ ì‚¬ìš©í•´ì£¼ì–´ì•¼ í•œë‹¤.

```typescript
await db.collection("users").updateOne(
  { email: "coco@example.com" },
  {
    $set: {
      nickname: "newCoco",
      updatedAt: new Date(),
    },
  }
)
```

#### 2ï¸âƒ£ replaceOne()

ë¬¸ì„œ ì „ì²´ë¥¼ ìˆ˜ì •í•  ë–„ ì‚¬ìš©í•œë‹¤.

```typescript
await db.collection("users").replaceOne(
  { email: "coco@example.com" },
  {
    email: "coco@example.com",
    nickname: "coco",
    role: "user",
    createdAt: new Date(),
  }
)
```

`_id`ë¥¼ ì œì™¸í•˜ê³  ì „ë¶€ ìˆ˜ì •ë˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©ì‹œ ì£¼ì˜í•œë‹¤.

#### 3ï¸âƒ£ updateMany()

ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ë¥¼ í•œ ë²ˆì— ìˆ˜ì •í•´ì¤€ë‹¤.

> updateManyë¥¼ ì‚¬ìš©í•  ë•Œì—ë„ ë§ˆì°¬ê°€ì§€ë¡œ [$set](https://www.mongodb.com/ko-kr/docs/manual/reference/operator/update/set/) ë¥¼ ê¼­ ì‚¬ìš©í•´ì£¼ì–´ì•¼ í•œë‹¤.

```typescript
await db.collection("users").updateMany(
  { role: "guest" },
  {
    $set: {
      isActive: false,
    },
  }
)
```

í•´ë‹¹ ëª…ë ¹ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

> users ì»¬ë ‰ì…˜ì—ì„œ role ê°’ì´ guestì¸ ëª¨ë“  ì‚¬ìš©ì ë¬¸ì„œë¥¼ ì°¾ì•„ì„œ ê·¸ ë¬¸ì„œë“¤ì˜ isActive ê°’ì„ falseë¡œ ë³€ê²½í•œë‹¤.

```typescript
await db.collection("users").updateMany(
  {},
  {
    $set: {
      updatedAt: new Date(),
    },
  }
)
```

ì²˜ìŒì— ë¬¸ì„œë¥¼ í•„í„°ë§ í•  ë•Œ `{}` ë¥¼ ì‚¬ìš©í–ˆëŠ”ë°, ì˜ë¯¸ëŠ” users ì»¬ë ‰ì…˜ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ë¬¸ì„œì—ë¥¼ ì„ íƒí•˜ëŠ” ê²ƒì´ë©° ì´ì— ëŒ€í•´ updatedAt í•„ë“œë¥¼ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ ì„¤ì •í•œë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.

### ğŸŠ Delete

- deleteOne()
- deleteMany()

```typescript
await db.collection("users").deleteOne({
  _id: new ObjectId(userId),
})
```

`deleteOne`ì€ ì¡°ê±´ê³¼ ì¼ì¹˜í•˜ëŠ” ë¬¸ì„œ ì¤‘ í•˜ë‚˜ë§Œ ì‚­ì œí•œë‹¤. ë³´í†µ `_id`ê¸°ë°˜ ì‚­ì œì— í™œìš©í•œë‹¤.

```typescript
await db.collection("users").deleteMany({
  role: "guest",
})
```

`deleteMany`ëŠ” ì¡°ê±´ì— ì¼ì¹˜í•˜ëŠ” ëª¨ë“  ë¬¸ì„œë¥¼ ì‚­ì œí•œë‹¤.

ë§Œì•½ íŠ¹ì •í•œ ì¡°ê±´ ì—†ì´, ì»¬ë ‰ì…˜ì„ ì „ì²´ ì‚­ì œí•´ì•¼ í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë¹ˆê°ì²´ë¥¼ í˜¸ì¶œí•œë‹¤.

```typescript
await db.collection("users").deleteMany({})
```

- <https://mongoosejs.com/>
- <https://www.geeksforgeeks.org/mongodb/mongoose-populate-method/>
- <https://www.mongodb.com/ko-kr/docs/drivers/node/current/crud/insert/>
