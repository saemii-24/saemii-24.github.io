---
title: "FEí…ŒìŠ¤íŠ¸(2) - vitest"
author: saemii
categories:
  - Test
tags:
  - [Vitest, ReatTestingLibrary]
date: 2024-09-21
last_modified_at: 2024-09-21
pin: true
---

## ğŸ“Œì‹œì‘í•˜ë©°

ì´ì „ í¬ìŠ¤íŒ…ì—ì„œ í…ŒìŠ¤íŠ¸ì— ì•ì„œ í…ŒìŠ¤íŠ¸ì˜ ë°°ê²½ê³¼ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚´í´ë´¤ë‹¤ë©´, ì´ë²ˆì—ëŠ” ì‹¤ì œë¡œ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ apië¥¼ ì •ë¦¬í•´ë³´ê³ ì í•œë‹¤.

## âœ…it

it í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ íŠ¹ì • ë™ì‘ì´ë‚˜ ê²°ê³¼ì— ëŒ€í•œ ê¸°ëŒ€ë¥¼ ì •ì˜í•˜ê³ , ì´ë¥¼ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì•ˆì— ì‘ì„±í•˜ê²Œ ëœë‹¤. it í•¨ìˆ˜ ì•ˆì— ì‘ì„±ë˜ëŠ” ì„¤ëª…ì€ í…ŒìŠ¤íŠ¸ ëª©ì , ê¸°ëŒ€ ê²°ê³¼ë¥¼ ëª…í™•í•˜ê²Œ ì‘ì„±í•˜ë„ë¡ í•œë‹¤.

ë˜í•œ, it í•¨ìˆ˜ëŠ” test í•¨ìˆ˜ì˜ alias(ëŒ€ì²´ ì´ë¦„)ìœ¼ë¡œ, ë™ì¼í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ”ë°, ë‚˜ëŠ” itìœ¼ë¡œ ì‘ì„±í•˜ëŠ”ê±¸ ì„ í˜¸í•œë‹¤.

```typescript
import { it, expect } from "vitest"

it("2ì™€ 3ì„ ë”í•˜ë©´ 5ê°€ ë˜ì–´ì•¼ í•œë‹¤.", () => {
  const result = 2 + 3
  expect(result).toBe(5)
})
```

## âœ…desribe

describeëŠ” itì´ë‚˜ testë¡œ ì‘ì„±ëœ ì—¬ëŸ¬ ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ê·¸ë£¹í™”í•´ ì»´í¬ë„ŒíŠ¸ ì•ˆì˜ ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ ê°€ë…ì„± ìˆê²Œ ì •ë¦¬í•  ìˆ˜ ìˆë‹¤.

```typescript
import { describe, it, expect } from "vitest"

describe("ê³„ì‚° ê¸°ëŠ¥", () => {
  it("2ì™€ 3ì„ ë”í•˜ë©´ 5ê°€ ë˜ì–´ì•¼ í•œë‹¤.", () => {
    const result = 2 + 3
    expect(result).toBe(5)
  })

  it("5ì—ì„œ 2ë¥¼ ë¹¼ë©´ 3ì´ ë˜ì–´ì•¼ í•œë‹¤.", () => {
    const result = 5 - 2
    expect(result).toBe(3)
  })
})
```

## âœ…expect

ê²°ê³¼ë¥¼ ìµœì¢…ì ìœ¼ë¡œ ê²€ì¦í•˜ëŠ”ë° ì‚¬ìš©í•œë‹¤. expectëŠ” ë‹¨ì–¸ë¬¸ìœ¼ë¡œì¨, íŠ¹ì • ì¡°ê±´ì´ë‚˜ ìƒíƒœê°€ ì°¸ì¸ì§€ í™•ì¸í•œë‹¤.
ìœ„ì—ì„œ ì‚´í´ë³¸ ì˜ˆì œë¥¼ ë³´ë©´ expectë¥¼ ìœ„ì— í•´ë‹¹ ê¸°ëŠ¥ì˜ ê°’ì´ 5ì¼ê²ƒì´ë¼ëŠ” ê²ƒì„ ë‹¨ì–¸í•˜ê³  ì´ë¥¼ ê¸°ì¤€ì„ ë‘ê³  ì°¸ê³¼ ê±°ì§“ì„ íŒë³„í•˜ê²Œ ëœë‹¤.

```typescript
import { it, expect } from "vitest"

it("2ì™€ 3ì„ ë”í•˜ë©´ 5ê°€ ë˜ì–´ì•¼ í•œë‹¤.", () => {
  const result = 2 + 3
  expect(result).toBe(5)
})
```

## âœ…vi

viëŠ” ëª¨ë“ˆì„ **ëª¨í‚¹(mocking)** í•˜ê±°ë‚˜, í•¨ìˆ˜ì˜ í˜¸ì¶œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” ë° ì‚¬ìš©í•œë‹¤.

- ëª¨í‚¹(mocking): íŠ¹ì • ê¸°ëŠ¥ì´ë‚˜ ê°ì²´ì˜ ë™ì‘ì„ í‰ë‚´ë‚´ê±°ë‚˜ ëŒ€ì²´í•œë‹¤.

ë§ì´ ì¢€ ì´í•´ê°€ ì–´ë ¤ìš´ë°, A ë¡œì§ì´ ë¬´ì–¸ê°€(B)ë¥¼ ì˜ì¡´í•´ì„œ êµ¬í˜„ëœë‹¤ê³  ê°€ì €í•´ë³´ì. ì´ë•Œ A ë¡œì§ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ì„œëŠ” Bê°€ í•„ìš”í•˜ì§€ë§Œ, Bë¥¼ êµ¬í˜„í•˜ê¸° ë³µì¡í•  ë•ŒëŠ” ëª¨í‚¹ì„ í†µí•´ Bë¥¼ ëŒ€ì²´í•˜ì—¬ A ë¡œì§ì„ ê²€ì¦í•  ìˆ˜ ìˆê²Œ ëœë‹¤.

### â¡ï¸ ëª¨í‚¹

ëª¨í‚¹ì€ `vi.fn()`ì„ ì‚¬ìš©í•´ ê°„ë‹¨íˆ êµ¬í˜„í•œë‹¤. ì´ë¥¼ í†µí•´ íŠ¹ì • ë¡œì§ì„ ëŒ€ì²´í•  ìˆ˜ ìˆëŠ” ê°€ìƒì˜ í•¨ìˆ˜ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.

```typescript
vi.fn()
```

### â¡ï¸ ìŠ¤íŒŒì´

`vi.spyOn()`ì„ ì‚¬ìš©í•´ íŠ¹ì • ê°ì²´ì˜ ë©”ì„œë“œë¥¼ ê°ì‹œí•´ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€, ì–´ë–¤ ì¸ìë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```typescript
const spy = vi.spyOn(ê°ì²´, "ê°ì²´ ì•ˆì˜ ë©”ì†Œë“œ ì´ë¦„")
```

```typescript
import { describe, it, expect } from "vitest"

const calculator = {
  add: (a: number, b: number) => a + b,
}

describe("ê³„ì‚° ê¸°ëŠ¥", () => {
  it("2ì™€ 3ì„ ë”í•˜ë©´ 5ê°€ ë˜ì–´ì•¼ í•œë‹¤.", () => {
    // ìŠ¤íŒŒì´ ìƒì„±
    const spy = vi.spyOn(calculator, "add") //calculator ê°ì²´ì™€ ê°ì²´ì•ˆì˜ ë©”ì†Œë“œ

    // ë©”ì„œë“œ í˜¸ì¶œ
    const result = calculator.add(2, 3) //ìœ„ì—ì„œ ì •ì˜í•œ add ë©”ì†Œë“œë¥¼ ë¶ˆëŸ¬ì˜´

    // ê²°ê³¼ í™•ì¸
    expect(result).toBe(5) // ê²°ê³¼ê°€ 5ì¸ì§€ í™•ì¸

    // ìŠ¤íŒŒì´ë¥¼ ì‚¬ìš©í•´ í˜¸ì¶œ ì—¬ë¶€ ë° ì¸ì í™•ì¸
    expect(spy).toHaveBeenCalled() // add ë©”ì„œë“œê°€ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸
    expect(spy.mock.calls[0]).toEqual([2, 3]) // ì²« ë²ˆì§¸ í˜¸ì¶œì˜ ì¸ìê°€ [2, 3]ì¸ì§€ í™•ì¸
  })
})
```

### â¡ï¸ íƒ€ì´ë¨¸ ëª¨í‚¹

`vi.useFakeTimers()`ë¥¼ ì‚¬ìš©í•´ íƒ€ì´ë¨¸ë¥¼ ëª¨í‚¹í•´setTimeout, setInterval ë“±ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.

ì´ë¥¼ í†µí•´, 5ì´ˆ í›„ì— ì‹¤í–‰ ë˜ì–´ì•¼ í•˜ëŠ” í…ŒìŠ¤íŠ¸ê°€ ì¡´ì¬í•œë‹¤ê³  í–ˆì„ ë•Œ, í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ 5ì´ˆë¥¼ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.

ë‹¤ë§Œ, ê°€ì§œ íƒ€ì´ë¨¸ë¥¼ ì‹¤í–‰í•œ ê²½ìš° ë‹¤ë¥¸ ë¡œì§ì—ë„ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, `vi.useRealTimers()` ë¥¼ ì´ìš©í•´ ì›ë˜ íƒ€ì´ë¨¸ë¡œ ë³µêµ¬í•´ì•¼í•¨ì— ìœ ì˜í•œë‹¤.

```typescript
vi.useFakeTimers()
```

```typescript
import { vi, expect, it } from "vitest"

function runAfterDelay(callback: () => void, delay: number) {
  setTimeout(callback, delay)
}

it("íƒ€ì´ë¨¸ê°€ 5ì´ˆ í›„ì— ë™ì‘í•´ì•¼ í•¨", () => {
  // íƒ€ì´ë¨¸ë¥¼ ëª¨í‚¹
  vi.useFakeTimers()

  // ì½œë°± í•¨ìˆ˜ë¥¼ ìŠ¤íŒŒì´ë¡œ ì„¤ì •
  const callback = vi.fn()

  // í•¨ìˆ˜ í˜¸ì¶œ
  runAfterDelay(callback, 5000)

  // ì•„ì§ ì½œë°±ì´ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
  expect(callback).not.toHaveBeenCalled()

  // 5ì´ˆë¡œ íƒ€ì´ë¨¸ ë¹ ë¥´ê²Œ ì§„í–‰
  vi.advanceTimersByTime(5000)

  // ì½œë°±ì´ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸
  expect(callback).toHaveBeenCalled()

  // íƒ€ì´ë¨¸ ë³µêµ¬ (ì›ë˜ì˜ íƒ€ì´ë¨¸ë¡œ ëŒì•„ê°€ê¸°)
  vi.useRealTimers()
})
```

## âœ…beforeEach & beforeAll

before~ì´ë€ ì´ë¦„ì—ì„œ ìœ ì¶”í•  ìˆ˜ ìˆë“¯ì´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ì‚¬ìš©ëœë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë§ˆë‹¤ ë°˜ë³µì ì¸ ì»´í¬ë„ŒíŠ¸ ë Œë”ë§ì´ í•„ìš”í•œ ê²½ìš°, before~ë¥¼ ì‚¬ìš©í•˜ë©´ í•œ ë²ˆì— ê¹”ë”í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

- **beforeEach**: ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ì— íŠ¹ì • ì‘ì—… ìˆ˜í–‰
- **beforeAll**: ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰ ì „ ë‹¨ í•œ ë²ˆë§Œ íŠ¹ì • ì‘ì—… ìˆ˜í–‰ (ì´ˆê¸°í™” ì‘ì—… ë“±)

```typescript
import { describe, beforeEach, beforeAll, it, expect } from "vitest"

let counter = 0

describe("beforeEach vs beforeAll ì°¨ì´ì ", () => {
  // í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— í•œ ë²ˆë§Œ ì‹¤í–‰
  beforeAll(() => {
    counter = 10 // ëª¨ë“  í…ŒìŠ¤íŠ¸ì— ì ìš©í•  ì´ˆê¸° ì„¤ì • (ìµœì´ˆ 1íšŒ ì‹¤í–‰)
  })

  // ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ì— ì‹¤í–‰
  beforeEach(() => {
    counter += 1 // í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ê°œë³„ì ìœ¼ë¡œ ì‹¤í–‰í•  ì‘ì—… (ê° í…ŒìŠ¤íŠ¸ ë§ˆë‹¤ 1íšŒ ì‹¤í–‰)
  })

  it("ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸", () => {
    expect(counter).toBe(11) // beforeAllì˜ 10ê³¼ beforeEach +1 ì— ì˜í•´ 11
  })

  it("ë‘ ë²ˆì§¸ í…ŒìŠ¤íŠ¸", () => {
    expect(counter).toBe(12) // ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸ í›„ beforeEachë§Œ ì¬ì‹¤í–‰ë˜ì–´ +1 ì¦‰ 12
  })
})
```

## âœ…afterEach & afterAll

beforeEachì™€ beforeAllê³¼ ë°˜ëŒ€ë¡œ, í…ŒìŠ¤íŠ¸ í›„ì— íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

- **afterEach**: ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ì— íŠ¹ì • ì‘ì—… ìˆ˜í–‰
- **afterAll**: ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰ í›„ ë‹¨ í•œ ë²ˆë§Œ íŠ¹ì • ì‘ì—… ìˆ˜í–‰

```typescript
import { describe, afterEach, afterAll, it, expect } from "vitest"

let counter = 0

describe("afterEachì™€ afterAll ì°¨ì´ì ", () => {
  // ê° í…ŒìŠ¤íŠ¸ ì‹¤í–‰ í›„ì— ì‹¤í–‰
  afterEach(() => {
    counter -= 1 // ê° í…ŒìŠ¤íŠ¸ê°€ ëë‚œ í›„ -1
  })

  // ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ëë‚œ í›„ì— ì‹¤í–‰
  afterAll(() => {
    counter -= 2
  })

  it("ì²« ë²ˆì§¸ í…ŒìŠ¤íŠ¸", () => {
    counter += 1 // ì´ˆê¸°ê°’ 0 ì— + 1 = 1
    expect(counter).toBe(1) // 1ì´ ë˜ì–´ì•¼ í•¨
  })

  //ì´í›„ afterEachê°€ ì‹¤í–‰ ë˜ì–´ 1 - 1 = 0

  it("ë‘ ë²ˆì§¸ í…ŒìŠ¤íŠ¸", () => {
    counter += 1 // 0ì— + 1 = 1
    expect(counter).toBe(1) // 1ì´ ë˜ì–´ì•¼ í•¨
  })

  //ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œ ë˜ì–´ afterAll ì‹¤í–‰ 1 - 2 = -1
  //ì´ ì‹œì ì—ì„œ counterëŠ” -1
})
```

## ğŸ—‚ï¸ì°¸ê³  ì‚¬ì´íŠ¸

- <https://vitest.dev/api/>
