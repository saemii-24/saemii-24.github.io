---
title: "FE테스트(3) - React Testing Library"
author: saemii
categories:
  - Test
tags:
  - [Vitest, ReatTestingLibrary]
date: 2024-09-24
last_modified_at: 2024-09-24
pin: true
---

## 📌시작하며

이번엔 vitest와 함께 사용되어 사용자 관점에서 테스트 할 수 있게 도와주는 React Testing Library에 대해 알아보고자 한다.

React Testing Library는 실제 사용자가 UI를 어떻게 사용하는지 초점을 맞춰 테스트하는 것을 권장하며, 이를 구현하기 위한 API를 살펴보자.

## ✅DOM 요소 선택 (get~)

DOM 요소를 선택하는 방식 (Queries)는 세 가지 방식이 있다.

| 종류    | 설명                                                                      |
| ------- | ------------------------------------------------------------------------- |
| getBy   | 일치하는 요소를 즉시 반환, 요소가 없으면 에러 발생                        |
| queryBy | 일치하는 요소 반환, 없으면 null 반환                                      |
| findBy  | 비동기적으로 요소 찾음, 요소가 없을 땐 Promise 거부, 시간이 지나면 재시도 |

### ➡️getBy

| 종류                 | 설명                                                             |
| -------------------- | ---------------------------------------------------------------- |
| getByRole            | 접근성 트리 이용. **가장 권장됨**                                |
| getByLabelText       | 주로 폼 필드의 라벨 이용해 검색                                  |
| getByPlaceholderText | 플레이스 홀더를 이용해 검색                                      |
| getByText            | 텍스트를 이용해 요소 검색                                        |
| getByAltText         | alt 속성을 가진 요소를 검색                                      |
| getByTitle           | title 속성을 가진 요소를 검색                                    |
| getByTestId          | 테스트를 위해 element에 이름을 붙임. `data-testid`를 사용해 정의 |
| getByDisplayValue    | 폼에서 현재 입력된 값 기반으로 요소 선택                         |

### ➡️screen

이제 위에서 살펴본 내용을 활용해 요소를 찾아보자.
DOM 요소를 찾을 때는 `screen` 키워드를 사용한다.
screen은 document.body에 바인딩되어 있어, screen.getBy~ findBy~ 등을 사용해 DOM에서 요소를 찾을 수 있다.

```typescript
import { screen, render } from "@testing-library/react"
import { describe, it, expect } from "vitest"
import Example from "./Example"

describe("Example 컴포넌트 테스트", () => {
  it("Example 컴포넌트 내 요소를 검색한다.", () => {
    render(<Example />)
    const element = screen.getByText("내가 찾는 요소")
    expect(element).toBeInTheDocument()
  })
})
```

## ✅이벤트 시뮬레이션

위에서 DOM요소를 찾고 렌더링 했으니 이번엔 사용자 이벤트를 시뮬레이션 해보자.

### ➡️fireEvent

간단한 사용자 이벤트 (click, change, keydown 등)는 fireEvent를 이용해 시뮬레이션 할 수 있다.

아래 예제는 버튼 컴포넌트를 렌더링하고 사용자가 클릭하는 상황을 테스트한다.

```typescript
import { render, fireEvent, screen } from "@testing-library/react"
import { vi } from "vitest"

const Button = ({ onClick }) => <button onClick={onClick}>클릭하세요</button>

it("버튼 클릭 시 onClick 함수가 호출된다", () => {
  // vitest를 이용해 handleClick이란 함수를 모킹한다.
  const handleClick = vi.fn()

  // 버튼 컴포넌트를 렌더링 한다.
  render(<Button onClick={handleClick} />)

  //text를 기준으로 요소를 찾고, 클릭 이벤트를 발생시킨다.
  fireEvent.click(screen.getByText("클릭하세요"))

  // handleClick 함수가 1번 호출 되는 것을 검증한다.
  expect(handleClick).toHaveBeenCalledTimes(1)
})
```

fireEvent로 검증할 수 있는 이벤트는 아래와 같다.

```typescript
import { render, fireEvent, screen } from "@testing-library/react"
import { vi } from "vitest"

const Button = ({ onClick }) => <button onClick={onClick}>클릭하세요</button>

it("fireEvent를 이용할 수 있는 이벤트 들", () => {
  //클릭 이벤트
  fireEvent.click(screen.getByText("이벤트 종류"))
  //체인지 이벤트 (input, select 등에 사용)
  fireEvent.change(screen.getByL  abelText("이름"), {
    target: { value: "신짱구" },
  })
  //키보드 입력 이벤트
  fireEvent.keyDown(screen.getByText("키보드 입력"), { key: 'Enter', code: 'Enter' })
  //포커스 & 블러
  fireEvent.focus(screen.getByLabelText("포커스 테스트"))
  fireEvent.blur(screen.getByLabelText("포커스 테스트"))
  //폼 제출
  fireEvent.submit(screen.getByText("제출"))
  //드래그 관련 이벤트
  fireEvent.drag(screen.getByText("드래그 이벤트"))
  fireEvent.dragStart(screen.getByText("드래그 시작"))
  fireEvent.dragEnd(screen.getByText("드래그 끝"))
  //더블 클릭 이벤트
  fireEvent.doubleClick(screen.getByText("더블 클릭"))

})
```

## 🗂️참고 사이트

- <https://testing-library.com/docs/dom-testing-library/intro>
