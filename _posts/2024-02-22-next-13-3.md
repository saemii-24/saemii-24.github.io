---
title: "Next.js 13ì˜ íŠ¹ì§•ê³¼ ë³€í™”(3) - API Routes"
author: saemii
categories:
  - Next.js
tags:
  - [Next.js, Web]
date: 2024-02-24
last_modified_at: 2024-02-24
pin: true
---

## ğŸ“Œì‹œì‘í•˜ë©°

> ì´ ê¸€ì€ ì•„ë˜ì™€ ê°™ì´ ì´ì–´ì§‘ë‹ˆë‹¤.
>
> - [Next.js 13ì˜ íŠ¹ì§•ê³¼ ë³€í™”(1)](https://saemii-24.github.io/posts/next-13-1/)
> - [Next.js 13ì˜ íŠ¹ì§•ê³¼ ë³€í™”(2)](https://saemii-24.github.io/posts/next-13-2/)
> - [Next.js 13ì˜ íŠ¹ì§•ê³¼ ë³€í™”(3)](https://saemii-24.github.io/posts/next-13-3/)

routes ë¶€ë¶„ë„ 12 ë²„ì „ê³¼ ë‹¬ë¼ì§„ ë¶€ë¶„ì´ ê½¤ ìˆë‹¤! í—·ê°ˆë¦¬ì§€ ì•Šë„ë¡ ì´ ë²ˆì—” Next13ì˜ API RoutesğŸŒ¹ì— ëŒ€í•´ ì•Œì•„ë³´ì.

## âœ…API Routes

Next.jsë¥¼ ì™œ ì“°ëƒëŠ” ì§ˆë¬¸ì´ ë‚˜ì˜¤ë©´ ì•„ë§ˆ API routesë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒë„ ê·¸ ì´ìœ  ì¤‘ í•˜ë‚˜ì¼ ê²ƒì´ë‹¤. ê·¸ë˜ì„œ API routesê°€ ë­˜ê¹Œ?
ê³µì‹ ë¬¸ì„œì—ì„œëŠ” ì´ë ‡ê²Œ ì„¤ëª…í•œë‹¤.

> API routesëŠ” Next.jsì—ì„œ public APIë¥¼ ë§Œë“œëŠ” ì—­í• ì„ í•œë‹¤.
>
> API ë¼ìš°íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ Next.js ì•± ë‚´ì—ì„œ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ë¡œ ë°°í¬í•  ìˆ˜ ìˆë‹¤.

ì •ë¦¬í•˜ìë©´ ì„œë²„ë¦¬ìŠ¤ ë°±ì—”ë“œ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤. ì¦‰, Next,jsë¥¼ ì´ìš©í•´ RESTful APIë¥¼ ë§Œë“¤ê³  í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìê°€ ì„œë²„ ì¸¡ ì½”ë“œë¥¼ ì‘ì„±í•´ ê°„ë‹¨í•˜ê²Œ ë°±ì—”ë“œë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆë‹¤.

> ì—”ë“œí¬ì¸íŠ¸: íŠ¹ì •í•œ ìš”ì²­ì„ ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” ì§€ì 

## âœ…ê¸°ì¡´ ë°©ì‹

```
pages/
  â””â”€ api/
      â””â”€ hello.ts ğŸ‘ˆ
```

ê¸°ì¡´ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì€ í´ë” êµ¬ì¡°ì— apiì•ˆì˜ js(ts)íŒŒì¼ì„ api endpointë¡œ ì·¨ê¸‰í–ˆë‹¤.
ë˜í•œ POST ë°©ì‹ì´ë©´ `req.method` ë¥¼ ì´ìš©í•´ í•´ë‹¹ ë°©ì‹ì´ POST ì„ì„ ì¡°ê±´ë¬¸ìœ¼ë¡œ ì²˜ë¦¬í•œ í›„ ì‘ì„±í•´ì•¼ í–ˆë‹¤. í•˜ì§€ë§Œ Next13ì€ ì¢€ë” ì§ê´€ì ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ë³€ê²½ë˜ì—ˆë‹¤.

```typescript
import type { NextApiRequest, NextApiResponse } from "next"

export default function handler(req: NextApiRequest, res: NextApiResponse) {
  if (req.method === "POST") {
    // POST ìš”ì²­ì— ê´€í•œ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.
  } else {
    // POSTê°€ ì•„ë‹Œ ë‹¤ë¥¸ ìš”ì²­ ì²˜ë¦¬
  }
}
```

## âœ…ìƒˆë¡œìš´ ë°©ì‹

```
app/
â”‚
â””â”€â”€ api/
    â”‚
    â”œâ”€â”€ firstApi/
    â”‚   â””â”€â”€ route.ts ğŸ‘ˆ
    â”‚
    â””â”€â”€ secondApi/
        â””â”€â”€ route.ts ğŸ‘ˆ
```

ë¨¼ì € í´ë” êµ¬ì¡°ê°€ ë³€ê²½ë˜ì—ˆë‹¤. app router ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ í´ë” êµ¬ì¡°ë¥¼ ì·¨í•œë‹¤. api í´ë” ì•ˆì— apiì˜ íŠ¹ì •í•œ ì´ë¦„ì„ ê°€ì§„ í´ë”ë¥¼ ë§Œë“¤ê³  `routes.ts` íŒŒì¼ì„ ë§Œë“¤ì–´ ì‘ì„±í•œë‹¤.

`function`ì˜ ì´ë¦„ì€ **method ì´ë¦„**ìœ¼ë¡œ ì‘ì„±í•œë‹¤.

```typescript
export async function GET() {
  const res = await fetch("https://data.mongodb-api.com/...", {
    next: { revalidate: 60 }, // 60ì´ˆë§ˆë‹¤ ì¬ì‹¤í–‰
  })
  const data = await res.json()

  return Response.json(data)
}
```

## âœ…body ë°›ì•„ì˜¤ê¸°

`req.json()` ì„ ì´ìš©í•´ ë°›ì•„ì˜¨ë‹¤.

```typescript
export async function POST(req: Request) {
  //body í™•ì¸
  const { bodyText }: { bodyText: number } = await req.json()
}
```

## âœ…ì¿¼ë¦¬ìŠ¤íŠ¸ë§ ë°›ì•„ì˜¤ê¸°

`new URL(req.url)` ì„ ì´ìš©í•´ ë°›ì•„ì˜¨ë‹¤.

```typescript
import { type NextRequest } from "next/server"

export async function GET(req: NextRequest) {
  const { searchParams } = new URL(req.url)
  const page = searchParams.get("page") as string
  const count = searchParams.get("count") as string
}
```

`.nextUrl.searchParams` ì„ ì´ìš©í•´ ë°›ì•„ì˜¬ ìˆ˜ë„ ìˆë‹¤. (ê³µì‹ë¬¸ì„œ ì„¤ëª…)

```typescript
import { type NextRequest } from "next/server"

export function GET(request: NextRequest) {
  const searchParams = request.nextUrl.searchParams
  const query = searchParams.get("query")
  // query is "hello" for /api/search?query=hello
}
```

## âœ…formData ë°›ì•„ì˜¤ê¸°

`request.formData()`ì„ ì´ìš©í•´ ë°›ì•„ì˜¨ë‹¤.

```typescript
export async function POST(request: Request) {
  const formData = await request.formData()
  const name = formData.get("name")
  const email = formData.get("email")
  return Response.json({ name, email })
}
```

> ì‹¤ì œ formDataë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ì€ í”„ë¡œì íŠ¸ ì§„í–‰ í•˜ë©° ì¶”ê°€ë¡œ ì‘ì„±í•  ì˜ˆì •ì´ë‹¤.

## âœ…ì‚¬ìš© ì˜ˆì œ

ê·¸ëŸ¼ ì‹¤ì œ ì‚¬ìš© í•˜ëŠ” ë°©ì‹ì„ ì´ ì •ë¦¬í•´ ì‚´í´ë³´ì!
ì»´í¬ë„ŒíŠ¸ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ ìš”ì²­ì„ ë³´ë‚¸ë‹¤. axiosì˜ ê¸°ë³¸ ê°’ì€ GET ìš”ì²­ì´ë¯€ë¡œ í•´ë‹¹ ìš”ì²­ì€ GET ìš”ì²­ì´ë©°, ìš”ì²­ urlì„ ì‚´í´ë³´ë©´ ë‹¤ìŒê³¼ ê°™ì€ í´ë” êµ¬ì¡°ì˜ `route.ts`ì— ìš”ì²­ì„ ë³´ë‚´ê³  ìˆìŒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```
app/
â”‚
â””â”€â”€ api/
    â”‚
    â””â”€â”€ hello/
        â””â”€â”€ route.ts ğŸ‘ˆ
```

### â¡ï¸GET ìš”ì²­ê³¼ API routes

```typescript
const fetchHello = async () => {
  const { data } = await axios(`/api/hello?id=${id}`)
  return data as HelloType
}
```

```typescript
import { NextResponse } from "next/server"

export async function GET(req: NextResponse) {
  const { searchParams } = new URL(req.url)
  const id = searchParams.get("id") as string

  if (!id) {
    return NextResponse.json({ error: "idê°€ ì—†ìŠµë‹ˆë‹¤." }, { status: 400 })
  }

  return NextResponse.json(result, { status: 200 })
}
```

## âœ…Cookies ì‚¬ìš©í•˜ê¸°

ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ë²•ì—ëŠ” ë‘ ê°€ì§€ê°€ ìˆë‹¤. ë¨¼ì € `next/headers` ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ì´ë‹¤.

```typescript
import { cookies } from "next/headers"

export async function GET(request: Request) {
  const cookieStore = cookies()
  const token = cookieStore.get("token")

  return new Response("Hello, Next.js!", {
    status: 200,
    headers: { "Set-Cookie": `token=${token.value}` },
  })
}
```

ë” ê°„ë‹¨í•˜ê²Œ `NextRequest`ë¥¼ ì´ìš©í•´ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

```typescript
import { type NextRequest } from "next/server"

export async function GET(request: NextRequest) {
  const token = request.cookies.get("token")
}
```

## âœ…Header ì‚¬ìš©í•˜ê¸°

Cookiesì™€ ë™ì¼í•˜ê²Œ ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

```typescript
import { headers } from "next/headers"

export async function GET(request: Request) {
  const headersList = headers()
  const referer = headersList.get("referer")

  return new Response("Hello, Next.js!", {
    status: 200,
    headers: { referer: referer },
  })
}
```

```typescript
import { type NextRequest } from "next/server"

export async function GET(request: NextRequest) {
  const requestHeaders = new Headers(request.headers)
}
```

## âœ…NextResponse vs Response

ìœ„ì—ì„œ ì‚´í´ë³´ë©´, ê²°ê³¼ê°’ì„ `NextResponse` í˜¹ì€ `Response` ë¥¼ ì´ìš©í•´ return í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤. ê³µë¶€í•  ë•Œ ì­‰ NextResponseë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë‹ˆ ê³µì‹ë¬¸ì„œì— ìˆëŠ” Responseë¥¼ ë³´ê³  ë‘ ê°œì˜ ì°¨ì´ì ì„ ì°¾ì•„ë³´ì•˜ë‹¤.
ê²°ë¡ ì€ NextResponseê°€ Web Responseë¥¼ í™•ì¥í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ì¦‰ íŠ¹ë³„í•˜ê²Œ NextResponseë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ Responseë¡œ ì¶©ë¶„í•˜ë‹¤.

```typescript
return NextResponse.json({ result: "ê²°ê³¼ê°’" }, { status: 200 })
return Response.json({ result: "ê²°ê³¼ê°’" }, { status: 200 })
```

## ğŸ“©ë§ˆë¬´ë¦¬

app routerì˜ í´ë” êµ¬ì¡°ë¥¼ ì´ë ‡ê²Œ í›‘ì–´ë³´ì•˜ë‹¤. ë‹¤ìŒì—ëŠ” api routes ì‘ì„±ë²•ì— ëŒ€í•´ ì‚´í´ë³´ì!

## ğŸ—‚ï¸ì°¸ê³  ì‚¬ì´íŠ¸

- <https://nextjs.org/docs/pages/building-your-application/routing/api-routes>
- <https://nextjs.org/docs/app/building-your-application/routing/route-handlers>
- <https://stackoverflow.com/questions/77332669/use-nextresponse-response-or-nextapiresponse-in-returning-get-and-data-in-next>
