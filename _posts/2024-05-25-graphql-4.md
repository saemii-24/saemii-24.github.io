---
title: "Graph QL(4) - Create, Read "
author: saemii
categories:
  - Optimize
tags:
  - [Optimize, Next.js, Project]
date: 2024-05-25
last_modified_at: 2024-05-25
pin: true
---

## ğŸ“Œì‹œì‘í•˜ë©°

ì•ì—ì„œ Graph QLì„ ê°„ë‹¨í•˜ê²Œ í›‘ì–´ë´¤ëŠ”ë°... ê·¸ëŸ¼ REST APIì—ì„œ ë§í•˜ëŠ” CRUDëŠ” ì–´ë–»ê²Œ êµ¬í˜„í•˜ëŠ”ê±°ì§€?ğŸ¤” ë¼ëŠ” ì˜ë¬¸ì´ ë“¤ì—ˆê³  ê°„ë‹¨í•œ ì–´í”Œì„ ë§Œë“¤ì–´ ë³´ë©´ì„œ ê³µë¶€í•œ ë‚´ìš©ì„ ì •ë¦¬í•˜ê³ ìí•œë‹¤.

(ì •í™•íˆ ë§í•˜ë©´ CRUDëŠ” ì•„ë‹ˆì§€ë§Œ ì´ ê¸€ì—ì„œëŠ” í¸ì˜ì„±ì„ ìœ„í•´ CRUDë¼ê³  ì‘ì„±í•œë‹¤)

## âœ…ì „ì²´ íë¦„

ì´ CRUDë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ì„œëŠ” í¬ê²Œ ì„¸ ë¶€ë¶„ì„ ì‘ì„±í•˜ê²Œ ëœë‹¤. (ìì„¸í•œ ë‚´ìš©ì€ ì´ [í¬ìŠ¤íŒ…](https://saemii-24.github.io/posts/graphql-3) ì°¸ì¡°)

**ğŸ“Œë°±ì—”ë“œ** <br/>

- typeDefs

- resolvers

**ğŸ“Œí”„ë¡ íŠ¸ì—”ë“œ** <br/>

- useQuery

- useMutation

## âœ…Read

ì½ëŠ” ë¶€ë¶„ì€ `type Query`ë¥¼ ì‚¬ìš©í•œë‹¤. ì´ë•Œ, Query ë‚´ë¶€ì— ì‚¬ìš©í•˜ëŠ” ë‹¤ë¥¸ typeë„ í•¨ê»˜ ì§€ì •í•˜ëŠ” ê²ƒì— ì£¼ì˜í•œë‹¤!

ì•„ë˜ ì˜ˆì œë¥¼ ë³´ë©´, `type Book`ê³¼ `type Movie`ì„ ì§€ì •í•˜ê³  `type Query`ì—ì„œ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

```typescript
// server.js
const typeDefs = gql`
  type Book {
    id: Int
    title: String
    author: String
  }

  type Movie {
    id: Int
    title: String
    director: String
    release: Int
  }

  type Query {
    books: [Book]
    movies: [Movie]
  }
`
```

Apollo Serverê°€ ì´ Queryê°€ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ë¶ˆëŸ¬ì˜¬ì§€ resolversì— í• ë‹¹í•´ ì¤€ë‹¤. booksì™€ moviesëŠ” ë¯¸ë¦¬ ë§Œë“¤ì–´ ë‘” ë°ì´í„°ë¥¼ í• ë‹¹í•´ ì£¼ì—ˆë‹¤.

```typescript
const books = [
  {
    id: 1,
    title: "í•´ë¦¬í¬í„°",
    author: "JK ë¡¤ë§",
  },
  {
    id: 2,
    title: "ê·¸ë¦¬ê³  ì•„ë¬´ë„ ì—†ì—ˆë‹¤",
    author: "ì• ê±°ì„œ í¬ë¦¬ìŠ¤í‹°",
  },
]

const movies = [
  {
    id: 1,
    title: "ìˆ˜ìˆ˜ê»˜ë¼! ê½ƒí”¼ëŠ” ì²œí•˜ë–¡ìí•™êµ",
    director: "íƒ€ì¹´í•˜ì‹œ ì™€íƒ€ë£¨",
    release: 2022,
  },
  {
    id: 2,
    title: "ë²”ì£„ë„ì‹œ4",
    director: "í—ˆëª…í–‰",
    release: 2024,
  },
]

const resolvers = {
  Query: {
    books: () => books,
    movies: () => movies,
  },
}
```

ë°±ì—”ë“œì—ì„œì˜ ì‘ì—…ì€ ë§ˆë¬´ë¦¬ ë˜ì—ˆìœ¼ë‹ˆ, ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì´ ë°ì´í„°ë“¤ì„ ì½ì–´ë³´ì.

```typescript
import { gql, useQuery } from "@apollo/client"

export const BOOKS = gql`
  query {
    books {
      title
      author
      id
    }
  }
`

function Read() {
  const { loading, error, data } = useQuery(BOOKS)

  if (loading) return <p>ë¡œë”©ì¤‘!</p>
  if (error) return <p>ì—ëŸ¬ë°œìƒ!</p>
  return (
    <>
      <h2>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°(Get)</h2>
      {data.books.map(
        ({
          title,
          author,
          id,
        }: {
          title: string
          author: string
          id: number
        }) => (
          <div key={title} className="book">
            <p>
              {author} : {title}
            </p>
          </div>
        )
      )}
    </>
  )
}

export default Read
```

1. `@apollo/client` ì—ì„œ gqlì™€ useQueryë¥¼ ê°€ì ¸ì˜¨ë‹¤.
2. BOOKS ì¿¼ë¦¬ë¥¼ ì‘ì„±

   - ì„œë²„ë¡œë¶€í„° ì±…ê³¼ ì˜í™” ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ GraphQL ì¿¼ë¦¬

3. useQuery í›… ì‚¬ìš©

   - GraphQL ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³  ì„œë²„ë¡œë¶€í„° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤. ì´ë•Œ
     loading, error, data ê°ì²´ë¥¼ í†µí•´ ë°ì´í„° ë¡œë”© ìƒíƒœë¥¼ ê´€ë¦¬í•˜ê³ , ë¡œë”© ì¤‘ì´ë©´ "ë¡œë”©ì¤‘!"ì„, ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ "ì—ëŸ¬ë°œìƒ!"ì„ í™”ë©´ì— í‘œì‹œí•œë‹¤.

4. ë°ì´í„° map
   - `data.books.map`ì„ ì‚¬ìš©í•´ ê° ì±…ì˜ ì •ë³´ë¥¼ ë°˜ë³µí•˜ê³  í™”ë©´ì— ì¶œë ¥í•œë‹¤.

## âœ…Create

Createë¶€í„°ëŠ” type Queryê°€ ì•„ë‹ˆë¼ `type Mutation`ì„ ì‚¬ìš©í•œë‹¤. ì‘ì„± íë¦„ ìì²´ëŠ” ìœ„ì™€ êµ‰ì¥íˆ ë¹„ìŠ·í•˜ë‹¤!

ë¨¼ì € `typeDefs`ë¥¼ ì´ìš©í•´ GraphQL ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•˜ì. ì˜ˆì œì—ì„œëŠ” Book íƒ€ì…ê³¼ addBook ë®¤í…Œì´ì…˜(Mutation)ì„ ì •ì˜í–ˆë‹¤. ì´ë•Œ `type Mutation`ì˜ ê²½ìš° Book íƒ€ì…ì„ ë°˜í™˜í•œë‹¤.

```typescript
const typeDefs = gql`
  type Book {
    id: Int
    title: String
    author: String
  }

  type Mutation {
    addBook(id: Int, title: String, author: String): Book
  }
`
```

ë‹¤ìŒì€ resolversë¥¼ í†µí•´ GraphQL ì„œë²„ê°€ ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì •ì˜í•´ì¤€ë‹¤.
addBookë¦¬ì¡¸ë²„ í•¨ìˆ˜ì˜ ë§¤ê°œë³€ìˆ˜ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- ì²« ë²ˆì§¸ ì¸ìˆ˜ \_ëŠ” ë¶€ëª¨ ê°ì²´ë¡œ, ì—¬ê¸°ì„œëŠ” ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì–¸ë”ìŠ¤ì½”ì–´ë¡œ í‘œì‹œí•œë‹¤.
- ë‘ ë²ˆì§¸ ì¸ìˆ˜ { title, author }ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ë®¤í…Œì´ì…˜ì„ ìš”ì²­í•  ë•Œ ì „ë‹¬í•˜ëŠ” ì¸ìˆ˜ë‹¤.

```typescript
const books = [
  {
    id: 1,
    title: "í•´ë¦¬í¬í„°",
    author: "JK ë¡¤ë§",
  },
  {
    id: 2,
    title: "ê·¸ë¦¬ê³  ì•„ë¬´ë„ ì—†ì—ˆë‹¤",
    author: "ì• ê±°ì„œ í¬ë¦¬ìŠ¤í‹°",
  },
]

let nextBookId = 3

const resolvers = {
  Mutation: {
    addBook: (_, { title, author }) => {
      const newBook = { id: nextBookId++, title, author }
      books.push(newBook)
      return newBook
    },
  },
}
```

addBook í•¨ìˆ˜ëŠ” ìœ„ì—ì„œ ë¯¸ë¦¬ ì •ì˜í•´ ë‘” books ë°°ì—´ì— newBookì´ë€ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ì¶”ê°€í•˜ê³ , newBookì„ returní•œë‹¤. <u>ì´ë ‡ê²Œ return í•œ ê°’ì€ í´ë¼ì´ì–¸íŠ¸ì¸¡ì—ì„œ `data.addBook`ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤!</u>

ì´ì œ í”„ë¡ íŠ¸ì—”ë“œ ì¸¡ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.

1. GraphQL ì¿¼ë¦¬(ADD_BOOK)ì„ ì‘ì„±í•œë‹¤.
2. `mutation AddBook($title: String, $author: String)`ì„ ì´ìš©í•´ AddBookì´ë¼ëŠ” Mutationì„ ì •ì˜í•œë‹¤. ì´ Mutationì€ titleê³¼ authorë¼ëŠ” ë‘ ê°œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤. addBook Mutationì˜ ê²°ê³¼ë¡œ `id`, `title`, `author`ê°€ ë°˜í™˜ëœë‹¤.

```typescript
import { useMutation, gql } from "@apollo/client"
import { useEffect, useState } from "react"

const ADD_BOOK = gql`
  mutation AddBook($title: String, $author: String) {
    addBook(title: $title, author: $author) {
      id
      title
      author
    }
  }
`
```

3. useMutation í›…ì„ ì‚¬ìš©í•´ ìœ„ì—ì„œ ì •ì˜í•œ `ADD_BOOK` GraphQL Mutationì„ í˜¸ì¶œí•œë‹¤. ì´ë–„ `refetchQueries` ì˜µì…˜ì„ ì‚¬ìš©í•´ Mutationì´ ì‹¤í–‰ëœ í›„ ìë™ìœ¼ë¡œ BOOKS ì¿¼ë¦¬ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë„ë¡ ì„¤ì •í•œë‹¤. <u>ì´ ì„¤ì •ì´ ì—†ë‹¤ë©´, ì—…ë°ì´íŠ¸ í•´ë„ ì´ê²ƒì´ **ë°˜ì˜ë˜ì§€ ì•ŠëŠ”ë‹¤.**</u>

4. useState í›…ì„ ì‚¬ìš©í•´ ë‚´ìš©ì„ ì—…ë°ì´íŠ¸ í•˜ë„ë¡ í•œë‹¤.

5.loadingì´ trueì¸ ê²½ìš° "ì¶”ê°€ ì¤‘..." í…ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•œë‹¤.

```typescript
export default function Create() {
  const [addBook, { data, loading, error }] = useMutation(ADD_BOOK, {
    refetchQueries: [{ query: BOOKS }],
  })
  const [title, setTitle] = useState<string>("")
  const [author, setAuthor] = useState<string>("")

  useEffect(() => {
    if (error) {
      console.error("ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.:", error)
    }
    if (data) {
      console.log("ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.:", data.addBook)
    }
  }, [data, error])

  return (
    <form
      onSubmit={(e) => {
        e.preventDefault()
        if (title && author) {
          addBook({
            variables: { title, author },
          }).catch((e) => {
            console.error("ì—ëŸ¬ê°€ ë°œìƒí–‡ìŠµë‹ˆë‹¤:", e)
          })
          setTitle("")
          setAuthor("")
        }
      }}
    >
      <input
        value={author}
        onChange={(e) => setAuthor(e.target.value)}
        placeholder="ì‘ê°€"
      />
      <input
        value={title}
        onChange={(e) => setTitle(e.target.value)}
        placeholder="ì±… ì œëª©"
      />
      <button type="submit" disabled={loading}>
        ì¶”ê°€í•˜ê¸°
      </button>
      {loading && <p>ì¶”ê°€ ì¤‘...</p>}
    </form>
  )
}
```

## ğŸ—‚ï¸ì°¸ê³  ì‚¬ì´íŠ¸

- <https://www.apollographql.com/docs/react/data/queries/>
- <https://www.apollographql.com/tutorials/lift-off-part3/08-the-usequery-hook-with-variables#-setting-up-the-usequery-hook>
