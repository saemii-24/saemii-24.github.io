---
title: "Vitest - React hook form í…ŒìŠ¤íŠ¸ ì—ëŸ¬"
author: saemii
categories:
  - Test
tags:
  - [Vitest, ReatTestingLibrary]
date: 2024-10-28
last_modified_at: 2024-10-28
pin: true
---

## ğŸ“Œìƒí™©

ë‚˜ë¥¼ ë„ˆë¬´ë‚˜ ê³ ë‡Œí•˜ê²Œ ë§Œë“¤ì—ˆë˜(...) react hook formì„ ì´ìš©í•œ Signin Component í…ŒìŠ¤íŠ¸ì— ê´€í•œ ë‚´ìš©ì„ ì‘ì„±í•´ë³´ê³ ì í•œë‹¤.ğŸ˜‡
~~(a.k.a. ì½”ë“œ í•œ ì¤„ì´ ë¶ˆëŸ¬ì˜¨ ì—ëŸ¬ íŒŒí‹°^^)~~

ë¨¼ì € ë¡œê·¸ì¸ í˜ì´ì§€ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ Signin Componentë¥¼ ë§Œë“¤ì—ˆë‹¤.
IDì™€ Passwordê°€ ì…ë ¥ ë˜ì–´ì•¼ í•˜ëŠ” input íƒœê·¸ëŠ” react hook formì„ ì‚¬ìš©í•´ ë§Œë“¤ì–´ ë‘” Input Componentë¥¼ í™œìš©í–ˆë‹¤.

ì‚¬ì‹¤ ì•„ë˜ Input Componentì—ì„œ ì‘ì„±í•œ ì½”ë“œ í•œ ì¤„ë¡œ ì¸í•œ ì—ëŸ¬ì˜€ì§€ë§Œ, <u>ì•„ë˜ ë¶€ë¶„ì—ëŠ” í•´ë‹¹ ì½”ë“œë¥¼ ì£¼ì„ì²˜ë¦¬ í•´ë‘ì—ˆë‹¤.</u>

```typescript
import React, { HTMLAttributes } from "react"
import { FieldValues, Path, UseFormRegister } from "react-hook-form"
import { FiSearch } from "react-icons/fi"
import { IoIosClose } from "react-icons/io"

interface InputProps<T extends FieldValues>
  extends HTMLAttributes<HTMLDivElement> {
  name: Path<T>
  label?: string
  placeholder?: string
  register: ReturnType<UseFormRegister<T>>
  error?: string
  reset?: () => void
  icon?: boolean
}

const Input = <T extends FieldValues>({
  name,
  label,
  placeholder = "",
  register,
  error,
  reset,
  icon = false,
  ...rest
}: InputProps<T>) => (
  <div className="h flex w-full flex-col gap-2" {...rest}>
    {label && (
      <label htmlFor={name} className="ml-1 text-sm font-medium text-white">
        {label}
      </label>
    )}
    <div
      className={`flex w-full items-center gap-3 rounded-full bg-white px-6 py-[12px]`}
    >
      {icon && <FiSearch className="text-gray-800" />}

      <input
        id={name}
        placeholder={placeholder}
        type="text"
        {...register}
        // onChange={(e) => {
        //   console.log(e.target.value)
        // }}
        className="flex-1 bg-transparent outline-none placeholder:font-medium placeholder:text-gray-500"
      />

      {reset && (
        <button onClick={reset} type="button" data-testid={`reset-${name}`}>
          <IoIosClose
            // reset í•¨ìˆ˜ í˜¸ì¶œ
            className="cursor-pointer text-2xl text-gray-800"
          />
        </button>
      )}
    </div>
    {error && <p className="ml-1 text-xs text-red-500">{error}</p>}
  </div>
)

export default Input
```

## âœ…í…ŒìŠ¤íŠ¸ë¥¼ ì‹œë„í•˜ë‹¤.

í…ŒìŠ¤íŠ¸ëŠ” ì´ 4ê°€ì§€ë¥¼ ì‹œë„í–ˆë‹¤. í•˜ì§€ë§Œ ëª¨ë“  í…ŒìŠ¤íŠ¸ì—ì„œ ì˜¤ë¥˜ë§Œ ë°œìƒí•  ë¿ ë‹¤ìŒìœ¼ë¡œ ì§„í–‰ë˜ì§€ ì•Šì•˜ë‹¤...ğŸ˜‡

```typescript
import { render, screen, fireEvent, act, waitFor } from "@testing-library/react"
import { vi } from "vitest"
import SigninForm from "@/components/SigninForm"

describe("SigninForm í…ŒìŠ¤íŠ¸", () => {
  it("í¼ ì œì¶œ ì‹œ ì˜¬ë°”ë¥¸ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œë‹¤", async () => {})

  it("ì…ë ¥ì´ ë¹„ì–´ìˆì„ ë•Œ ì—ëŸ¬ ë©”ì‹œì§€ê°€ í‘œì‹œëœë‹¤", async () => {})

  it("ìœ íš¨ì„± ê²€ì‚¬ê°€ í†µê³¼ë˜ì§€ ì•Šì„ ê²½ìš° ì—ëŸ¬ ë©”ì„¸ì§€ê°€ í‘œì‹œëœë‹¤", async () => {})

  it("resetField í˜¸ì¶œ ì‹œ ì…ë ¥ê°’ì´ ì´ˆê¸°í™”ëœë‹¤", async () => {})
})
```

## âœ…ë¬¸ì œë¥¼ ì°¾ì•„ë³´ì

ì‚¬ì‹¤ npm run devë¥¼ ì´ìš©í•´ í™•ì¸í•˜ë©´ ì™¸ê´€ìƒ(?) ìœ¼ë¡œëŠ” ì „í˜€ ë¬¸ì œê°€ ì—†ì—ˆë‹¤.
ì‚¬ìš©ìê°€ inputì— ì…ë ¥ì„ í•˜ê³  submit í•˜ë©´ ì‚¬ìš©ìê°€ ì‘ì„±í•œ idì™€ password ê°’ ëª¨ë‘ ì •í™•íˆ ë°›ì•„ì˜¤ê³  ìˆì—ˆê¸°ì— ì›ì¸ì€ ë”ë”ìš± ë¯¸ê¶ìœ¼ë¡œ ë¹ ì ¸ë“¤ì—ˆìœ¼ë‚˜..

domì„ í™•ì¸í•˜ëŠ” `screen.debug()`ê°€ ìƒê°ë‚˜ inputì— ê°’ì„ ì…ë ¥í•˜ê³  submit í•˜ê¸° ì „ì„ ê¸°ì¤€ìœ¼ë¡œ ì•ë’¤ ìƒí™©ì„ ì‚´í´ë³´ì•˜ì„ ë•Œ
íŒíŠ¸ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆì—ˆë‹¤.

```typescript
import { render, screen, fireEvent, act, waitFor } from "@testing-library/react"
import { vi } from "vitest"
import SigninForm from "@/components/SigninForm"

describe("SigninForm í…ŒìŠ¤íŠ¸", () => {
  it("í¼ ì œì¶œ ì‹œ ì˜¬ë°”ë¥¸ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œë‹¤", async () => {
    const onSubmit = vi.fn()
    render(<SigninForm onSubmit={onSubmit} />)

    const id = screen.getByPlaceholderText("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
    const password = screen.getByPlaceholderText("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
    const submitButton = screen.getByTestId("signin")

    screen.debug()

    // ì…ë ¥ê°’ ë³€ê²½
    await act(async () => {
      fireEvent.change(id, { target: { value: "id@test.com" } })
      fireEvent.change(password, { target: { value: "password1!" } })
    })
    await act(async () => {
      fireEvent.click(submitButton)
    })

    screen.debug()
  })
})
```

í˜„ì¬ ë‚´ê°€ ìƒê°í•˜ëŠ”ëŒ€ë¡œ ì‘ë™í•˜ë ¤ë©´, idì™€ password ëª¨ë‘ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í†µê³¼í•˜ê¸° ë•Œë¬¸ì— ì—ëŸ¬ë©”ì‹œì§€ê°€ ë°œìƒí•´ì„œëŠ” ì•ˆëœë‹¤.
í•˜ì§€ë§Œ ë‘˜ ë‹¤ **'í•„ìˆ˜ê°’ì…ë‹ˆë‹¤' ë¼ëŠ” ì—ëŸ¬ë©”ì„¸ì§€** ê°€ í‘œì‹œë˜ì–´ ìˆì—ˆê³ , ì´ë¥¼ í†µí•´ inputì˜ ê°’ì´ ì œëŒ€ë¡œ ë³€ê²½ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.
ê·¸ë˜ì„œ onChangeì— ë¬¸ì œê°€ ìƒê²¼ë‚˜... ë¼ê³  ì§ì‘í•˜ë©° Input ì»´í¬ë„ŒíŠ¸ë¥¼ ì°¬ì°¬íˆ ì‚´í´ë³¸ ê²°ê³¼...

```typescript
const Input = <T extends FieldValues>({
  name,
  label,
  placeholder = "",
  register,
  error,
  reset,
  icon = false,
  ...rest
}: InputProps<T>) => (
  //ìƒëµ
  <input
    id={name}
    placeholder={placeholder}
    type="text"
    {...register}
    onChange={(e) => {
      // ğŸ‘ˆ ì—¬ê¸° ì™œ ìˆë‹ˆ...
      console.log(e.target.value)
    }}
    className="flex-1 bg-transparent outline-none placeholder:font-medium placeholder:text-gray-500"
  />
  //ìƒëµ
)

export default Input
```

**ì›ì¸ì„ ë°œê²¬í–ˆë‹¤....** ğŸ¤¦â€â™€ï¸ ë°”ë¡œ ì´ ì½”ë“œ
ì‚¬ìš©ìê°€ inputì— ì…ë ¥í•  ë•Œë§ˆë‹¤ ì œëŒ€ë¡œ ê°’ì´ ë°›ì•„ì˜¤ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œ ì½”ë“œê°€ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ” ê²ƒì´ì—ˆë‹¤.

```
 onChange={(e) => {
      // ğŸ‘ˆ (ğŸ˜­)
      console.log(e.target.value)
    }}
```

## ğŸ¥ºë¬¸ì œì˜ ì›ì¸ì„ íŒŒê³ ë“¤ì–´ ë³´ë©´...

react hook formì˜ [register](https://react-hook-form.com/docs/useform/register)ë¥¼ ì‚´í´ë³´ì.
react hook formì˜ `register`ëŠ” onChange, onBlur, name, ref ì´ë ‡ê²Œ 4ê°€ì§€ë¥¼ ì´ë¯¸ ì‚¬ìš©í•˜ê³  ìˆë‹¤.

ì¦‰ ë‚´ê°€ ì¶”ê°€ë¡œ ì‘ì„±í•œ onChangeê°€ react hook formì¸¡ì—ì„œ ì ìš©ë˜ì–´ì•¼ í•  onChangeë¥¼ ê°„ì„­í•˜ê³  ìˆì—ˆê³ , ë•Œë¬¸ì— ì œëŒ€ë¡œ input ê°’ì„ ë³€ê²½í•˜ì§€ ëª»í–ˆë˜ ê²ƒì´ë‹¤.ğŸ˜£

```typescript
const { onChange, onBlur, name, ref } = register('firstName');

<input
  onChange={onChange}
  onBlur={onBlur}
  name={name}
  ref={ref}
/>
// ìœ„ì™€ ë™ì¼í•˜ë‹¤.
<input {...register('firstName')} />
```

onChangeëŠ” ë””ë²„ê¹…ì„ ìœ„í•´ ì‘ì„±í•œ ì½”ë“œ ì¼ ë¿ ì‹¤ì œ í™”ë©´ì—ëŠ” ì „í˜€ í•„ìš”ì—†ëŠ” ì½”ë“œì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì½”ë“œëŠ” ì‚­ì œí•´ì£¼ì—ˆê³ , í…ŒìŠ¤íŠ¸ëŠ” í†µê³¼í•˜ëŠ” ê²ƒì²˜ëŸ¼ ë³´ì˜€ì§€ë§Œ...! ë˜ë‹¤ì‹œ ì—ëŸ¬ë¥¼ ë§ˆì£¼í•˜ê²Œ ë˜ì—ˆë‹¤ ^^;

ê·¸ë˜ë„ ë“œë””ì–´(!) ê°’ì´ ë“¤ì–´ì˜¤ê¸´ í–ˆë‹¤ëŠ” ì—ëŸ¬ë©”ì„¸ì§€ë¥¼ ë³´ê³  ì¡°ê¸ˆ ê°ê²©í•˜ê³  ë‹¤ì‹œ ì—ëŸ¬ë©”ì‹œì§€ë¥¼ ì‚´í´ë³´ì•˜ë‹¤.

## âœ… ë‘ ë²ˆì§¸ ì—ëŸ¬

ì œì¶œì€ ì˜¬ë°”ë¥´ê²Œ ë˜ì—ˆì§€ë§Œ ë¬¸ì œëŠ” ì´ ë°ì´í„°ê°€ ë‚´ê°€ ì˜ˆìƒí•œ ë°ì´í„°ê°€ ë§ëŠ”ì§€ ëŒ€ì¡°í•˜ëŠ” ë¶€ë¶„ì´ì—ˆë‹¤.

```typescript
import { render, screen, fireEvent, act, waitFor } from "@testing-library/react"
import { vi } from "vitest"
import SigninForm from "@/components/SigninForm"

describe("SigninForm í…ŒìŠ¤íŠ¸", () => {
  it("í¼ ì œì¶œ ì‹œ ì˜¬ë°”ë¥¸ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œë‹¤", async () => {
    const onSubmit = vi.fn()
    render(<SigninForm onSubmit={onSubmit} />)

    const id = screen.getByPlaceholderText("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
    const password = screen.getByPlaceholderText("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
    const submitButton = screen.getByTestId("signin")

    screen.debug() //DOM ìƒíƒœ í™•ì¸

    // ì…ë ¥ê°’ ë³€ê²½
    await act(async () => {
      fireEvent.change(id, { target: { value: "id@test.com" } })
      fireEvent.change(password, { target: { value: "password1!" } })
    })
    await act(async () => {
      fireEvent.click(submitButton)
    })
    //on Submitì´ ì œëŒ€ë¡œ ì‘ë™í•œì§€ í™•ì¸
    await waitFor(() => {
      //ğŸ‘ˆ ì—ëŸ¬ ë°œìƒ
      expect(onSubmit).toHaveBeenCalledWith({
        id: "id@test.com", // id ê°’ ê²€ì¦
        password: "password1!", // password ê°’ ê²€ì¦
      })
    })
  })
})
```

ì—ëŸ¬ ë©”ì„¸ì§€ë¥¼ ì‚´í´ë³´ë©´ ê¸ˆë°© ì–´ë–¤ ê²ƒì´ ë¬¸ì œì¸ì§€ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.

```plain
  1st spy call:

  Array [
    Object {
      "id": "id@test.com",
      "password": "password1!",
    },
+   SyntheticBaseEvent {
+     "_reactName": "onSubmit",
+     "_targetInst": null,
+     "bubbles": true,
(ìƒëµ)
```

ì²«ë²ˆì§¸ Object{} ê°’ìœ¼ë¡œ ë‚´ê°€ ì›í•˜ëŠ” ê°’ì´ ë“¤ì–´ì™”ì§€ë§Œ, ê·¸ ì´í›„ SyntheticBaseEvent~ ë“±ì´ ë“¤ì–´ì˜¤ë©´ì„œ expectì—ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ì—ˆë‹¤. ê·¸ë˜ì„œ ì´ ë¶€ë¶„ì€ í•´ë‹¹ Object{} ê°’ë§Œ ë¹„êµí•˜ëŠ” ê²ƒìœ¼ë¡œ êµì²´í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ë§ˆë¬´ë¦¬í•  ìˆ˜ ìˆì—ˆë‹¤.ğŸ˜Š

```typescript
describe("SigninForm í…ŒìŠ¤íŠ¸", () => {
  it("í¼ ì œì¶œ ì‹œ ì˜¬ë°”ë¥¸ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•œë‹¤", async () => {
    const onSubmit = vi.fn()
    render(<SigninForm onSubmit={onSubmit} />)

    const id = screen.getByPlaceholderText("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
    const password = screen.getByPlaceholderText("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
    const submitButton = screen.getByTestId("signin")

    screen.debug() //DOM ìƒíƒœ í™•ì¸

    // ì…ë ¥ê°’ ë³€ê²½
    await act(async () => {
      fireEvent.change(id, { target: { value: "id@test.com" } })
      fireEvent.change(password, { target: { value: "password1!" } })
    })
    await act(async () => {
      fireEvent.click(submitButton)
    })
    //on Submitì´ ì œëŒ€ë¡œ ì‘ë™í•œì§€ í™•ì¸
    await waitFor(() => {
      // ì²« ë²ˆì§¸ ì¸ìë¥¼ ê°€ì ¸ì™€ì„œ í™•ì¸
      const firstCallArgs = onSubmit.mock.calls[0][0]
      expect(firstCallArgs).toEqual({
        id: "id@test.com",
        password: "password1!",
      })
    })
    screen.debug()
  })
})
```

## ğŸ™‹â€â™€ï¸ ë§ˆë¬´ë¦¬

ì‚¬ì‹¤ ê¸€ë¡œëŠ” ì´ ê³ ë¯¼ì˜ ì‹œê°„ì´ ì§§ê²Œ ëŠê»´ì§€ì§€ë§Œ ì •ë§ ì˜¤ëœ ì‹œê°„ í—¤ë§¸ê³ , í•´ê²° ë°©ë²•ì€ ë„ˆë¬´ ê°„ë‹¨í•´ì„œ ì´ë ‡ê²Œ ì“°ê¸°ì—ëŠ” ì¡°ê¸ˆ ë¶€ë„ëŸ½ì§€ë§Œ, í•´ê²°í•˜ê³ ì ë…¸ë ¥í–ˆë˜ ì‹œê°„ì´ ì•„ê¹ê²Œ ëŠê»´ì§€ì§„ ì•ŠëŠ”ë‹¤. ë¬´ì—‡ë³´ë‹¤ í•´ê²°í–ˆë‹¤ëŠ” ì„±ì·¨ê°ì´ ë” í¬ë‹ˆê¹Œ! ğŸ˜

ì•ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ì— ìµìˆ™í•´ì ¸ì„œ ë” ì¢‹ì€ ì»´í¬ë„ŒíŠ¸, ë” ì¢‹ì€ ì½”ë“œë¥¼ ì“°ê³  ì‹¶ë‹¤ëŠ” ë§ˆìŒì´ ê°€ë“í•˜ë‹¤.ğŸ¤— íŒŒì´íŒ…í•˜ì!
